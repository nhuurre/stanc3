  $ ../../../../../../../install/default/bin/stanc --auto-format naive-bayes-unsup.stan
data {
  int<lower=2> K;
  // num topics
  int<lower=2> V;
  // num words
  int<lower=1> M;
  // num docs
  int<lower=1> N;
  // total word instances
  int<lower=1, upper=V> w[N];
  // word n
  int<lower=1, upper=M> doc[N];
  // doc ID for word n
  vector<lower=0>[K] alpha;
  // topic prior
  vector<lower=0>[V] beta;
  // word prior
}
parameters {
  simplex[K] theta;
  // topic prevalence
  simplex[V] phi[K];
  // word dist for topic k
}
model {
  real gamma[M, K];
  theta ~ dirichlet(alpha);
  for (k in 1 : K) 
    phi[k] ~ dirichlet(beta);
  for (m in 1 : M) 
    for (k in 1 : K) 
      gamma[m, k] <- categorical_log(k, theta);
  for (n in 1 : N) 
    for (k in 1 : K) 
      gamma[doc[n], k] <- gamma[doc[n], k] + categorical_log(w[n], phi[k]);
  for (m in 1 : M) 
    increment_log_prob(log_sum_exp(gamma[m]));
  // to normalize s.t. gamma[m,k] = log Pr[Z2[m] = k|data]
  // gamma[m] <- gamma[m] - log_sum_exp(gamma[m]);
}


Warning: deprecated language construct used in 'naive-bayes-unsup.stan', line 24, column 19:
   -------------------------------------------------
    22:     for (m in 1:M) 
    23:       for (k in 1:K) 
    24:         gamma[m,k] <- categorical_log(k,theta);
                            ^
    25:     for (n in 1:N)
    26:       for (k in 1:K)
   -------------------------------------------------

assignment operator <- is deprecated in the Stan language; use = instead.


Warning: deprecated language construct used in 'naive-bayes-unsup.stan', line 27, column 24:
   -------------------------------------------------
    25:     for (n in 1:N)
    26:       for (k in 1:K)
    27:         gamma[doc[n],k] <- gamma[doc[n],k] 
                                 ^
    28:                            + categorical_log(w[n],phi[k]);
    29:     for (m in 1:M)
   -------------------------------------------------

assignment operator <- is deprecated in the Stan language; use = instead.


Warning: deprecated language construct used in 'naive-bayes-unsup.stan', line 30, column 22:
   -------------------------------------------------
    28:                            + categorical_log(w[n],phi[k]);
    29:     for (m in 1:M)
    30:       increment_log_prob(log_sum_exp(gamma[m]));
                               ^
    31:  
    32:     // to normalize s.t. gamma[m,k] = log Pr[Z2[m] = k|data]
   -------------------------------------------------

increment_log_prob(...); is deprecated and will be removed in the future. Use target += ...; instead.

  $ ../../../../../../../install/default/bin/stanc --auto-format naive-bayes.stan
// supervised naive Bayes
data {
  // training data
  int<lower=1> K;
  // num topics
  int<lower=1> V;
  // num words
  int<lower=0> M;
  // num docs
  int<lower=0> N;
  // total word instances
  int<lower=1, upper=K> z[M];
  // topic for doc m
  int<lower=1, upper=V> w[N];
  // word n
  int<lower=1, upper=M> doc[N];
  // doc ID for word n
  // hyperparameters
  vector<lower=0>[K] alpha;
  // topic prior
  vector<lower=0>[V] beta;
  // word prior
}
parameters {
  simplex[K] theta;
  // topic prevalence
  simplex[V] phi[K];
  // word dist for topic k
}
model {
  // priors
  theta ~ dirichlet(alpha);
  for (k in 1 : K) 
    phi[k] ~ dirichlet(beta);
  // likelihood, including latent category
  for (m in 1 : M) 
    z[m] ~ categorical(theta);
  for (n in 1 : N) 
    w[n] ~ categorical(phi[z[doc[n]]]);
}

